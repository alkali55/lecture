<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>문화시설 상세 정보</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles2.css" rel="stylesheet" />
        <!-- jquery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <script src="js/commonJS.js"></script>
        <!-- kakaomap api -->
        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=779052ad52aa171e888adae6da6fbe97"></script>

        <script>
            const MY_KEY = "bodgvmkG3ToKBU%2F0FLZyS%2BqJqDmGqVwnPAUXUra4%2BDyM9KVDC8m2a2D37GdWyytohVNW92pmylfOVX4UamgU4w%3D%3D";
            let contentId = "";
            let comData = [];
            let infoData = new Object();


            $(function(){
                contentId = getParameter("contentid");
                // console.log(getParameter("contentid"));
                // console.log(typeof contentId);
                if(contentId == null){
                    location.href = "cultureList.html";
                } else {
                    getInfoData(); // 소개정보조회
                    getTourData(); // 공통정보조회
                    getAdditionalIamge(); // 이미지정보조회
                }


                // 개요, 정보, 이용안내 버튼 클릭 이벤트
                $(".info-btn").click(function(){
                    // console.log($(this).attr("class"));
                    if (!$(this).hasClass("btn-primary")){
                        $(".info-btn").removeClass("btn-primary");
                        $(this).addClass("btn-primary");
                        if ($(this).hasClass("information")){

                            let output = `<table class="table"><tr><th class="table-info">주소</th><td>${inputText(comData.addr1)}</td></tr>`;
                            output += `<tr><th class="table-info">전화번호</th><td>${inputTel()}</td></tr>`;
                            output += `<tr><th class="table-info">홈페이지</th><td>${inputText(comData.homepage)}</td></tr>`;
                            output += `</table>`;
                            $(".card-table").html(output);

                        } else {
                            let output = `<table class="table">`;

                            $.each(Object.keys(infoData), function(i, item){
                                if (infoData[item] != ""){
                                    switch(i){
                                        case 2: 
                                            output += `<tr><th class="table-info">규모</th><td>${infoData[item]}</td></tr>`;
                                            break;
                                        case 3:
                                            output += `<tr><th class="table-info">이용요금</th><td>${infoData[item]}</td></tr>`;
                                            break;
                                        case 4:
                                            output += `<tr><th class="table-info">할인정보</th><td>${infoData[item]}</td></tr>`;
                                            break;
                                        case 5:
                                            output += `<tr><th class="table-info">관람소요시간</th><td>${infoData[item]}</td></tr>`;
                                            break;
                                        case 6:
                                            output += `<tr><th class="table-info">주차요금</th><td>${infoData[item]}</td></tr>`;
                                            break;
                                        case 7:
                                            output += `<tr><th class="table-info">문의 및 안내</th><td>${infoData[item]}</td></tr>`;
                                            break;
                                        case 8:
                                            output += `<tr><th class="table-info">수용인원</th><td>${infoData[item]}</td></tr>`;
                                            break;
                                        case 9:
                                            output += `<tr><th class="table-info">이용시간</th><td>${infoData[item]}</td></tr>`;
                                            break;
                                        case 10:
                                            output += `<tr><th class="table-info">쉬는 날</th><td>${infoData[item]}</td></tr>`;
                                            break;
                                        case 11:
                                            output += `<tr><th class="table-info">주차시설</th><td>${infoData[item]}</td></tr>`;
                                            break;
                                        case 12:
                                            output += `<tr><th class="table-info">유모차 대여 정보</th><td>${infoData[item]}</td></tr>`;
                                            break;
                                        case 13:
                                            output += `<tr><th class="table-info">애완동물 동반 가능 정보</th><td>${infoData[item]}</td></tr>`;
                                            break;
                                        case 14:
                                            output += `<tr><th class="table-info">신용카드 가능 정보</th><td>${infoData[item]}</td></tr>`;
                                            break;

                                    }
                                }
                            })
                            
                            output += `</table>`;

                            $(".card-table").html(output);

                        }
                    }
                    
                });
                
            })
            
            function inputTel(){
                let comTel = comData.tel;
                let infoTel = infoData.infocenterculture;

                if(comTel == "" && infoTel == ""){
                    return "정보없음";
                } else if (comTel != "" && infoTel == ""){
                    return comTel;
                } else if (comTel == "" && infoTel != ""){
                    return infoTel;
                } else {
                    return `${comTel}, ${infoTel}`;
                }
            }

            function inputText(text){
                if (text == ""){
                    return "정보없음";
                } else {
                    return text;
                }
            }

            function addInfoData(json){
                infoData = json.response.body.items.item[0];
                
            }

            function getInfoData(){
                let url = `http://apis.data.go.kr/B551011/KorService1/detailIntro1`;
                url += `?MobileOS=ETC&MobileApp=AppTest&serviceKey=${MY_KEY}&_type=json`;
                url += `&contentId=${contentId}&contentTypeId=14`;
                
                console.log(url);$.ajax({
                    url: url, // 데이터가 송수신될 서버의 주소
                    type: "GET", // 통신 방식 (GET, POST, PUT, DELETE)
                    dataType: "json", // 수신받을 데이터의 타입 (MIME TYPE)
                    async: false, // 비동기옵션 off
                    success: function(data){ // 통신이 성공하면 수행할 함수
                        console.log(data);
                        addInfoData(data);
                    },
                    error: function(){},
                    complete: function(){
                    }
                });
            }

            function addComData(json){
                comData = json.response.body.items.item[0];
                
                // 카카오 맵 생성
                addMap();

                $(".card-title").html(comData.title);

                let output = `<table class="table"><tr><th class="table-info">주소</th><td>${inputText(comData.addr1)}</td></tr>`;
                output += `<tr><th class="table-info">전화번호</th><td>${inputTel()}</td></tr>`;
                output += `<tr><th class="table-info">홈페이지</th><td>${inputText(comData.homepage)}</td></tr>`;
                output += `</table>`;
                $(".card-table").html(output);
                $(".card-overview").html(comData.overview);

            }

            function getTourData(){
                let url = `http://apis.data.go.kr/B551011/KorService1/detailCommon1`;
                url += `?MobileOS=ETC&MobileApp=AppTest&serviceKey=${MY_KEY}&_type=json`;
                url += `&contentId=${contentId}&defaultYN=Y&addrinfoYN=Y&mapinfoYN=Y&overviewYN=Y`;

                $.ajax({
                    url: url, // 데이터가 송수신될 서버의 주소
                    type: "GET", // 통신 방식 (GET, POST, PUT, DELETE)
                    dataType: "json", // 수신받을 데이터의 타입 (MIME TYPE)
                    async: false, // 비동기옵션 off
                    success: function(data){ // 통신이 성공하면 수행할 함수
                        console.log(data);
                        addComData(data);
                    },
                    error: function(){},
                    complete: function(){
                    }
                });
            }

            function addImg(json){
                console.log(json);
                let imgArr = json.response.body.items.item;
                let indicatorsOutput = ``;
                let itemsOutput = ``;
                if (json.response.body.items !== ""){
                    $.each(imgArr, function(i, item){
                        if(i == 0){
                            indicatorsOutput += `<button type="button" data-bs-target="#demo" data-bs-slide-to="${i}" class="active"></button>`;
                            itemsOutput += `<div class="carousel-item active"><img src="${item.originimgurl}" class="d-block w-100 img-thumbnail"></div>`;
                        } else {
                            indicatorsOutput += `<button type="button" data-bs-target="#demo" data-bs-slide-to="${i}"></button>`;
                            itemsOutput += `<div class="carousel-item"><img src="${item.originimgurl}" class="d-block w-100 img-thumbnail"></div>`;
                        }
                    })
                } else {
                    indicatorsOutput += `<button type="button" data-bs-target="#demo" data-bs-slide-to="0" class="active"></button>`;
                    itemsOutput += `<div class="carousel-item active"><img src="images/noImage.jpeg" class="d-block w-100"></div>`;
                }

                $(".carousel-indicators").html(indicatorsOutput);
                $(".carousel-inner").html(itemsOutput);
            }

            function getAdditionalIamge(){
                let url = `http://apis.data.go.kr/B551011/KorService1/detailImage1`;
                url += `?MobileOS=ETC&MobileApp=AppTest&serviceKey=${MY_KEY}&_type=json`;
                url += `&contentId=${contentId}&imageYN=Y&subImageYN=Y`;

                $.ajax({
                    url: url, // 데이터가 송수신될 서버의 주소
                    type: "GET", // 통신 방식 (GET, POST, PUT, DELETE)
                    dataType: "json", // 수신받을 데이터의 타입 (MIME TYPE)
                    async: false, // 비동기옵션 off
                    success: function(data){ // 통신이 성공하면 수행할 함수
                        // console.log(data);
                        addImg(data);
                    },
                    error: function(){},
                    complete: function(){
                    }
                });
            }
        
            function addMap(){
                let container = document.getElementById('map');
                let options = {
                    center: new kakao.maps.LatLng(comData.mapy, comData.mapx),
                    level: 3
                };
                let map = new kakao.maps.Map(container, options);

                // 마커
                let markerPosition  = new kakao.maps.LatLng(comData.mapy, comData.mapx); 
                let marker = new kakao.maps.Marker({
                    position: markerPosition
                });
                marker.setMap(map);
            }

        </script>
        <style>
            .carousel-container{
                display: flex;
                justify-content: center;
            }
            #demo{
                margin-top: 10px;
                margin-left: 10px;
            }
            .carousel-map{
                display: flex;
            }
            .card-title{
                margin-top: 20px;
                margin-bottom: 20px;
            }
            .btn{
                border: 1px solid gray;
            }
            .card-text{
                margin-top: 15px;
                border: 1px solid rgba(201, 190, 190, 0.918);
                padding: 10px;
            }
            .card-table{
                height: 164px;
                overflow-y: scroll;
            }
            .table-info{
                width: 200px;
            }
            th {
                align-content: center;
            }
            
        </style>
    </head>
    <body>
        <!-- Responsive navbar-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container px-5">
                <a class="navbar-brand" href="#!">Tour API</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item"><a class="nav-link active" aria-current="page" href="#!">문화 시설</a></li>
                        <li class="nav-item"><a class="nav-link" href="#!">찜</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Page Content-->
        <div class="container px-4 px-lg-5">
            <!-- Heading Row-->
            <div class="row gx-4 gx-lg-5 align-items-center my-5 headDiv">
                <div >
                    <h1 class="font-weight-light">문화시설 관광 정보</h1>
                    
                </div>
            </div>
            
            <!-- Content Row-->
            <div id="cardBox">
                <div class="card" style="width:100%">
                    <div class="carousel-map" style="width: 100%;">
                        <!-- Carousel -->
                        <div id="demo" class="carousel slide" data-bs-ride="carousel" style="width: 50%;">
                
                            <!-- Indicators/dots -->
                            <div class="carousel-indicators">
                            
                            </div>
                        
                            <!-- The slideshow/carousel -->
                            <div class="carousel-inner">
                            
                            </div>
                        
                            <!-- Left and right controls/icons -->
                            <button class="carousel-control-prev" type="button" data-bs-target="#demo" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon"></span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#demo" data-bs-slide="next">
                            <span class="carousel-control-next-icon"></span>
                            </button>
                        </div>

                        <div id="map" style="width:500px;height:350px;"></div>
                        
                    </div>
                    <div class="card-body">
                      <h2 class="card-title"></h2>
                      <button class="btn info-btn information btn-primary">정보</button>
                      <button class="btn info-btn parking">이용안내</button>
                      <div class="card-text card-table"></div>
                      <div class="card-text card-overview"></div>
                    </div>
                </div>
            </div>

        </div>
        
        
        <!-- Footer-->
        <footer class="py-5 bg-dark">
            <div class="container px-4 px-lg-5"><p class="m-0 text-center text-white">Copyright &copy; Goot5</p></div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>
