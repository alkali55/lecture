<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="css/validate.css">
    <title>Document</title>
    <script>
        // 유효성 검사
        // 아이디 검사 (4자 이상 8자 이하)


        function registerValid(){

            // 가입하기 버튼을 클릭하면 호출
            // 모든 유효성 검사를 통과하면 true 아니면 false
            let isValid = false;

            let idCheck = checkUserId($("#userId").val());
            let pwdCheck = checkPwd($("#pwd1").val(), $("#pwd2").val());
            let emailCheck = checkEmail($("#email").val());

            // 휴대폰 유효성 검사
            let mobileNumCheck = checkMobileNum($("#mobile").val());
            let genderCheck = checkGender();

            // 취미 값 수집
            let hobbies = getHobby(); // 취미를 comma로 연결해서 반환

            let jobCheck = checkJob();
            let memo = getMemo();

            let agreeCheck = false;
            // console.log(document.getElementById("agree").checked);

            if (document.getElementById("agree").checked == true){
                agreeCheck = true;
            } else {
                outputError("가입조항에 동의해 주세요.", $("#result-agree"));
            }

            if (idCheck && pwdCheck && emailCheck && mobileNumCheck && genderCheck && jobCheck && agreeCheck){
                isValid = true;
            }

            return isValid;
        }

        function checkMobileNum(mobileNum){
            let isValid = false;
            let mobileExp = /^01([0|1|6|7|8|9]?)-?([0-9]{3,4})-?([0-9]{4})$/;
            if (!mobileExp.test(mobileNum)){
                outputError("휴대폰 번호는 필수 항목입니다.", $("#mobile"));
            } else {
                isValid = true;
            }
            return isValid;
        }

        function getMemo(){
            // console.log(document.getElementById("memo").value);
            return document.getElementById("memo").value;
        }

        function checkJob(){
            // 직업 (*) 체크 여부
            let isValid = false;

            // console.log(document.getElementById("job").value);
            // console.log(document.getElementById("job").selectedIndex);

            //선택을 안 한 경우 : --직업을 선택하세요-- (value = "")
            // if (document.getElementById("job").value === ""){
            if (document.getElementById("job").selectedIndex == 0) {
                outputError("직업은 필수 항목입니다.", $("#job"));
            } else {
                isValid = true;
            }

            return isValid;
        }

        function getHobby(){
            let hobbies = "";
            let hobbyArr = document.getElementsByName("hobby");
            // console.log(hobbyArr);
            // 취미를 comma로 연결해서 반환

            for (let item of hobbyArr){
                if (item.checked == true){
                    hobbies += item.value + ",";
                }
            }
            
            return hobbies.substring(0, hobbies.length - 1);
        }

        function checkGender(){
            let isValid = false;
            let radioFemale = false;
            let radioMale = false;
            // console.log(document.getElementsByName("gender")[0].checked); // 여성라디오 버튼 체크 여부 : true || false
            if(document.getElementsByName("gender")[0].checked){
                radioFemale = true;
            }
            if (document.getElementsByName("gender")[1].checked){
                radioMale = true;
            }

            // 아무 라디오버튼도 체크되지 않았다면
            if (radioFemale == false && radioMale == false){
                outputError("성별은 필수 항목입니다.", $("#radio-result"));
            } else {
                isValid = true;
            }

            return isValid;

        }

        function checkEmail(email){
            // console.log(email);
            // 이메일 (*) : 이메일 주소 형식인지 아닌지 검사
            // abc@abc.com, abc@abc.co.kr
            let emailRegExp = /^[0-9a-zA-Z]([-_\.+]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/;
            let isValid = false;
            if(email === ""){
                outputError("이메일은 필수 항목입니다.", $("#email"));
            } else if (!emailRegExp.test(email)){
                outputError("적합한 이메일 형식이 아닙니다.", $("#email"));
            } else {
                isValid = true;
            }

            return isValid;
        }

        function checkPwd(pwd1, pwd2){
            // 비밀번호 (*) : 4자 이상 12자 이하
            // console.log(pwd1, pwd2);
            // 4자 이상 12자 이하
            // pwd1 == pwd2 ?
            let isValid = false;
            if (pwd1 === "" ){
                outputError("비밀번호는 필수 항목입니다.", $("#pwd1"));
            } else if (pwd1.length < 4 || pwd1.length > 12){
                outputError("비밀번호는 4자 이상 12자 이하로 입력하세요.", $("#pwd1"));
            } else if (pwd1 !== pwd2){
                outputError("비밀번호가 일치하지 않습니다.", $("#pwd2"));
            } else {
                isValid = true;
            }

            return isValid;
        }

        function checkUserId(userId){
            // 아이디 검사 (4자 이상 8자 이하)
            // 통과하면 true 아니면 false

            let isValid = false;

            // console.log(userId.length);
            if (userId === ""){
                // alert("아이디는 필수 항목입니다.");
                outputError("아이디는 필수 항목입니다.", $("#userId"));
            } else if (userId.length < 4 || userId.length > 8){
                // alert ("아이디를 4자 이상 8자 이하로 입력하세요")
                outputError("아이디를 4자 이상 8자 이하로 입력하세요", $("#userId"));
            } else {
                isValid = true;
            }
            return isValid;
        }

        function outputError(errorMsg, tagObj){
            let err = `<span class='errMsg'>${errorMsg}</span>`;
            $(err).insertAfter($(tagObj).prev());
            $(".errMsg").hide(5000);
        }

    </script>
</head>
<body>
    <div class="container">
    <h1>회원가입</h1>
    <form action="sub.html">
        <p>아래 항목을 기입해 주세요. ( *은 필수 항목입니다.)</p>
        <hr/>
        <label for="userId"><b>아이디(*) :</b></label>
        <input type="text" name="userId" id="userId">

        <label for="pwd1"><b>비밀번호(*) :</b></label>
        <input type="password" name="pwd1" id="pwd1">

        <label for="pwd2"><b>비밀번호 확인(*) :</b></label>
        <input type="password" id="pwd2">

        <label for="email"><b>이메일(*) :</b></label>
        <input type="text" name="email" id="email">

        <label for="mobile"><b>휴대폰 번호(*) :</b></label>
        <input type="text" name="mobile" id="mobile">

        <fieldset>
            <legend>성별 (*)<span></span><span id="radio-result"></span></legend>            
        <div class="form-check">
            <input type="radio" class="form-check-input" id="female" name="gender" value="female" >
            <label class="form-check-label" for="female">여성</label>
        </div>
        <div class="form-check">
            <input type="radio" class="form-check-input" id="male" name="gender" value="male" >
            <label class="form-check-label" for="male">남성</label>
        </div>
        </fieldset>

        <fieldset>
            <legend>취미</legend>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="check1" name="hobby" value="study">
                <label class="form-check-label" for="check1">공부</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="check2" name="hobby" value="music">
                <label class="form-check-label" for="check2">음악감상</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="check3" name="hobby" value="travel">
                <label class="form-check-label" for="check3">여행</label>
            </div>
        </fieldset>

        <label for="job" class="form-label">직업 (*) (select one):</label>
        <!-- <select class="form-select" id="job" name="job" multiple> -->
        <select class="form-select" id="job" name="job">
            <option value="">--직업을 선택하세요--</option>
            <option value="student">학생</option>
            <option value="creator">크리에이터</option>
            <option value="landlord">건물주</option>
            <option value="official">공무원</option>
        </select>

        <div class="mb-3 mt-3">
            <label for="memo">메모:</label>
            <textarea class="form-control" rows="5" id="memo" name="memo"></textarea>
        </div>

        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="agree" name="agree" value="Y">
            <label class="form-check-label" for="agree">가입조항에 동의합니다 (*) </label>
            <div id="result-agree">
                <button type="submit" class="signupBtn" onclick="return registerValid();">가입하기</button>
                <button type="reset" class="cancelBtn">취소</button>
            </div>
        </div>
    </form>
    </div>
</body>
</html>