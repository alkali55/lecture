<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <title>2차원 배열을 이용한 성적표</title>
    <script>
      // 학번, 이름, 국, 영, 수
      const STU_CNT = 5; // 학생수 5명

      let scores = new Array(STU_CNT);
      scores = [
        ["250106", "홍길동", 77, 88, 90],
        ["250107", "홍길서", 77, 88, 80],
        ["250108", "홍길남", 77, 88, 70],
        ["250109", "홍길북", 77, 88, 100],
        ["250110", "홍길순", 77, 88, 90],
      ];
      console.log(scores);

      window.onload = function () {
        let order = "desc";
        calScores(); // 총점, 평균, 학점
        reOrder(order);
        document.getElementById("table").innerHTML = outputScores();
      };

    

      function calScores() {
        // 총점, 평균, 학점
        for (let i = 0; i < STU_CNT; i++) {
          // 총점
          scores[i][5] = scores[i][2] + scores[i][3] + scores[i][4];
          // 평균
          scores[i][6] = scores[i][5] / 3;
          // 학점
          scores[i][7] = calGrade(scores[i][6]);
        }
      }

      function calGrade(average) {
        // 평균점수를 받아서, 학점을 반환하는 함수
        // 학점 계산
        switch (Math.floor(average / 10)) {
          case 10:
          case 9:
            return "A";
            break;
          case 8:
            return "B";
            break;
          case 7:
            return "C";
            break;
          case 6:
            return "D";
            break;
          default:
            return "F";
            break;
        }
      }

      function orderScores() {
        // 정렬 버튼을 누르면 재정렬해서 (desc || asc) 화면에 출력
        // alert("!");
        let order = "";
        let radios = document.getElementsByName("order");

        // console.log(radios);
        for (let radio of radios) {
          //   console.log(radio.checked); // 체크가 된 경우 true
          if (radio.checked == true) {
            // console.log(radio.value);
            order = radio.value;
          }
        }
        console.log(order);
        reOrder(order);
        console.log(scores);
        document.getElementById("table").innerHTML = outputScores();
      }

      function reOrder(orderMethod) {
        for (let i = 0; i < scores.length - 1; i++) {
          // i = 0, 1, 2, 3
          for (let j = i + 1; j < scores.length; j++) {
            if (orderMethod == "desc") {
              // 평균 내림차순 정렬
              if (scores[i][6] < scores[j][6]) {
                // 자리바꿈 (swap)
                let tmp = scores[j];
                scores[j] = scores[i];
                scores[i] = tmp;
              }
              // 등수 처리
            } else if (orderMethod == "asc") {
              // 평균 오름차순 정렬
              if (scores[i][6] > scores[j][6]) {
                // 자리바꿈 (swap)
                let tmp = scores[j];
                scores[j] = scores[i];
                scores[i] = tmp;
              }
              // 평균에 따라서 등수도 오름차순
              let rank = 1;
              let curRank = 1;
              scores[STU_CNT - 1][8] = curRank; // 1등인 학생 (맨 아래)
              for (let i = STU_CNT - 2; i >= 0; i--){
                // i = 3, 2, 1, 0
                rank++;
                if (scores[i][6] != scores[i + 1][6]){
                    curRank = rank;
                }
                scores[i][8] = curRank;
              }
            }
          }
        }
      }
      // 평균에 따라서 등수도 내림차순
      // scores[0][8] = 1; // 0번째 행 학생을 1등.
      // for (let i = 1; i < scores.length; i++) {
      //   // i = 1, 2, 3, 4
      //   scores[i][8] = i + 1;
      //   if (scores[i - 1][6] == scores[i][6]) {
      //     scores[i][8] = scores[i - 1][8];
      //   }
      // }

      function outputScores() {
        // 테이블 태그 생성
        let rankoutput = "<table class='table'>";

        rankoutput += `<tr>
                  <th>학번</th>
                  <th>이름</th>
                  <th>국어</th>
                  <th>영어</th>
                  <th>수학</th>
                  <th>총점</th>
                  <th>평균</th>
                  <th>학점</th>
                  <th>등수</th>
              </tr>`;
        for (let i = 0; i < scores.length; i++) {
          rankoutput += "<tr>";
          for (let j = 0; j < scores[0].length; j++) {
            rankoutput += `<td>${scores[i][j]}</td>`;
          }
          rankoutput += "</tr>";
        }
        rankoutput += "</table>";

        return rankoutput;
      }
    </script>
  </head>
  <body>
    <div id="order">
      <input type="radio" name="order" id="asc" value="asc" /> 오름차순 정렬
      <input type="radio" name="order" id="desc" value="desc" checked />
      내림차순 정렬
      <button class="btn btn-success" onclick="orderScores()">정렬</button>
    </div>
    <div id="table"></div>
  </body>
</html>
